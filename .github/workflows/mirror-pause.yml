name: Mirror-Alert-Pause
on:
  issue_comment:
    types: [created]
jobs:
  pause:
    if: contains(github.event.comment.body, 'Mirror-Alert')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const alerts = await github.paginate(github.rest.issues.listComments, {
              owner: context.repo.owner, repo: context.repo.repo,
              issue_number: context.issue.number, since: new Date(Date.now()-86400000).toISOString()
            });
            const count = alerts.filter(c=>c.body.includes('Mirror-Alert')).length;
            if (count >= 2) {
              await github.rest.repos.updateBranchProtection({
                owner: context.repo.owner, repo: context.repo.repo,
                branch: 'main', restrictions: null  // 48 h lock
              });
              await github.rest.issues.createComment({
                owner: context.repo.owner, repo: context.repo.repo,
                issue_number: context.issue.number,
                body: '⏸️ 48-hour freeze activated—external approver required.'
              });
            }
